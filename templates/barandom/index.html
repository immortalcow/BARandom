<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>断箭 随机地图 & AI 专精</title>
    <!-- Bootstrap CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1 class="card-title">断箭 随机选择工具</h1>
          <p class="card-text text-muted">随机选择地图与 AI 专精（卡组），支持自定义玩家数量。</p>

          <div class="row g-3 align-items-center mb-3">
            <div class="col-auto">
              <label for="players" class="col-form-label">玩家数量</label>
            </div>
            <div class="col-auto">
              <input type="number" id="players" class="form-control" value="3" min="1" max="10">
            </div>
            <div class="col-auto">
              <button id="roll" class="btn btn-primary">随机生成</button>
            </div>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" value="1" id="unique" checked>
            <label class="form-check-label" for="unique">
              不重复选择 (默认启用)
            </label>
          </div>

          <div id="result" class="mt-4">
            <h5>地图: <span id="map" class="fw-bold">—</span></h5>
            <ul id="classes" class="list-group mt-2"></ul>
          </div>
        </div>
      </div>

      <footer class="text-center text-muted mt-4">
        Built by Github Copilot
      </footer>
    </div>

    <!-- jQuery & Bootstrap JS (CDN) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-..." crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>

    <script>
    $(function(){
      function render(data){
        $('#map').text(data.map);
        var $list = $('#classes').empty();
        data.players.forEach(function(p){
          $list.append('<li class="list-group-item">玩家 ' + p.id + ': ' + p.class + '</li>');
        });
        if (data.warning){
          if ($('#warning').length === 0){
            $('#result').append('<div id="warning" class="alert alert-warning mt-3"></div>');
          }
          $('#warning').text(data.warning);
        } else {
          $('#warning').remove();
        }
      }

      $('#roll').on('click', function(){
        var players = $('#players').val() || 3;
        var unique = $('#unique').is(':checked') ? 1 : 0;
        $.getJSON('/randomize/', {players: players, unique: unique})
          .done(function(data){ render(data); })
          .fail(function(){ alert('请求失败，请检查开发服务器是否已启动。'); });
      });
    });
    </script>
  </body>
</html>